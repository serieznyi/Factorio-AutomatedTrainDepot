# Депо поездов

## Цель

Ускорение и автоматизация процесса введения в эксплуатацию новых составов

## Описание постройки

Здание с двумя путями для составов на вход и выход.

Пути на выход упираются в *светофор* (`set-entity-type`) для контроля вывода состава из депо.

Пути на вход начинаются со *светофора* (`set-entity-type`) для контроля возможности принятия состава

Для функционирования здания в него необходимо передавать все необходимое для формирования состава:
- локомотивы
- вагоны
- топливо
- оборудование (опционально для оригинальной игры)

Логическая сеть принимает сигналы для управления депо

Логическая сеть возвращает ряд сигналов для оповещения о процессах

Здание имеет слоты для формирования/расформирования составов. Количество слотов увеличивается с помощью исследования

## Сигналы логической сети

Выход:
- Отсутствует локомотив для формирования состава. 
  
  [Signals=automated-train-depot-signal-locomotive-miss] 
  
- Отсутствует вагон для формирования состава. 
  
  [Signals=automated-train-depot-signal-wagon-miss] 
  
- Отсутствует оборудование для формирования состава.
  
  [Signals=automated-train-depot-signal-device-miss] 
  
- Отсутствует топливо для формируемого состава.
  
  [Signals=automated-train-depot-signal-fuel-miss] 
  
- Состав не может покинуть депо. 
  
  [Settings=depot-output-stopper-timeout-alert] Время через которое оповестить о невозможности составу покинуть депо
  
  [Signals=automated-train-depot-signal-depot-output-blocked]
  
- Состав не может попасть в депо. 
  
  [Settings=depot-input-stopper-timeout-alert] Время через которое оповестить о невозможности составу попасть в депо 
  
  [Signals=automated-train-depot-signal-depot-input-blocked]
  
- Состав не может попасть на станцию очистки. 
  
  [Settings=clean-station-stopper-timeout-alert] Время через которое оповестить о невозможности составу попасть на станцию очистки 
  
  [Signals=automated-train-depot-signal-clean-station-blocked]
  
- Количество составов в помеченной группе. Меткой группы выступает символ 0-9 A-Z. Метку выбирает пользователь. Например: A=3, B=0
  
  [Signals=signal-([0-9A-Z])]

- Содержимое инвентаря здания

Вход:
- Остановить производство составов
  
  [Signals=automated-train-depot-signal-stop-construction]
  
- Остановить отправку составов. (Примечание. Деактивирует оповещение о невозможности покинуть депо)
  
  [Signals=automated-train-depot-signal-block-output]
  
- Остановить принятие составов на разборку
  
  [Signals=automated-train-depot-signal-block-deconstruction]
  
- Запланированное количество составов для N-й группы. Меткой группы выступает сигнал 0-9 A-Z. Метку выбирает пользователь.
  
  [Signals=signal-([0-9A-Z])]

## Интерфейс

TODO

## Вывод в консоль
Есть возможность выводить в консоль: warning, info, debug сообщения
- critical:
    - warnings:
        - отсутствует локомотив для формирования состава.  
        - отсутствует вагон для формирования состава. 
        - отсутствует оборудование для формирования состава. 
        - отсутствует топливо для формируемого состава. 
        - состав <название группы> (<ID>) не может покинуть депо (use `logical-network-output-stopper-timeout`) 
        - состав <название группы> (<ID>) не может попасть в депо (use `logical-network-input-stopper-timeout`) 
        - состав <название группы> (<ID>) не может попасть на станцию очистки (use `logical-network-clean-station-stopper-timeout`) 
      - info:
        - todo
    - debug:
        - состав <название группы> (<ID>) прибыл в депо на расформирование
        - состав <название группы> (<ID>) расформирован
        - состав <название группы> (<ID>) сформирован
        - состав <название группы> (<ID>) покинул депо
        - состав <название группы> (<ID>) прибыл на станцию очистки
        - состав <название группы> (<ID>) покинул станцию очистки

[Settings=automated-train-depot-console-logging-level] Уровень выводимых уведомления: errors && warning, info, debug

## Описание возможностей

Депо имеет свой инвентарь

В депо можно задавать неограниченное (!!!ограничение движка, или может реально ограничить!!!) количество групп.

В группе можно/нужно указать
- название группы [Validator=required]
- иконку группы [Validator=required]
- цвет локомотивов. по умолчанию (оригинальный цвет) or (уникальный цвет для каждой группы) [Validator=required]
- информацию о структуре состава. Длина состава ограничена мощностью локомотивов. 
  [*] Обязателен один локомотив.
    - локомотив [Validator=required]
    - вагоны
    - типа топлива для локомотива
    - оборудование для локомотива
- количество составов, которое должно быть создано [Validator=required][Validator=Min(1)]
- активность контроля количества поездов [Default] false

[Ingame-Settings=automated-train-depot-use-any-fuel] Использовать любое топливо для всех групп

Есть отображение всех поездов созданных из текущей группы с расположением и возможностью отозвать конкретный поезд
в депо (отображение как в ваниле список поездов)

Все поезда созданные вне депо отображаются в отдельной группе. За ними так же можно следить и призвать на разборку

`CONSTRUCT_SECONDS` - количество секунд, которое равно времени создания всех используемых компонентов
(каждый локомотив + каждый вагон + каждый компонент)

[Settings] Время разбора/сбора состава по умолчанию [Checkbox] [Default] true
[Settings] Время разбора состава [Min] 1 sec
[Settings] Время разбора состава [Max] 60 sec

Конфигурацию можно клонировать

### Ввод в эксплуатацию новых составов

Депо может собирать за раз только один поезд

Время создания состава `CONSTRUCT_SECONDS` секунд

После создания новой группы нам необходимо добавить локомотив в состав.
В процессе сборки состава в строке состояния группы указывается информация о ее готовности.
По умолчанию контроль кол-ва составов в группе выключено.
При каждом изменении настроек группы - старые поезда отправляются на расформирование.

Так же есть возможность задать топливо, которым мы хотим заправить поезд. Или выбрать Any.

[Settings] Заправлять поезд любым из доступных видов топлива. true/false

### Расформирование составов

Обязательно необходимо указать станцию очистки для всех поездов.
Это станция на которую отправятся не пустые составы в момент запроса на расформирование.
До тех пор отправка на разбор будет недоступна для не пустых поездов.

[Console][Debug] Состав <ID> не может попасть в депо по причине наличия груза

[Console][Debug] 10 из 12 составов группы <NAME> отправлены в депо на разборку

Есть кнопка отправки *всех поездов группы* в депо на разборку

На разборку может отправиться только пустой поезд.

На разборку поезда отправляются после посещения станции **очистки**

Отправка поездов на разборку - является добавление составам станции [clean-station],
а за ней как конечной - [depo-deconstruction-station]

[Settings] По сколько поездов за раз отравлять на разборку. [Default] 3

Депо вмещает только один состав на разборку

Депо разбирает один состав CONSTRUCT_SECONDS секунд

### Прогрессия в дереве развития

- Количество парковочных мест (отдельно на вход и выход?)
- количество линий (отдельно на сборку и разборку?)
- скорость сборки и разборки
- количество групп  